//@version=5
indicator("GEX Levels [GexBot]", overlay=true, max_lines_count=500, max_labels_count=500)

// ==================== AUTO-GENERATED ====================
// Last update: 2025-12-25 18:33 UTC
// Data source: GexBot API
// Total levels: ES=17, NQ=17

// ==================== CONFIGURATION ====================
MIN_IMP = input.int(7, "Importance Min", minval=6, maxval=10)
MAX_LEVELS = input.int(20, "Max Niveaux", minval=5, maxval=50)
SHOW_LABELS = input.bool(true, "Labels")
SHOW_GEX = input.bool(false, "Valeurs GEX")
LINE_WIDTH = input.int(2, "Ã‰paisseur", minval=1, maxval=5)
EXTEND = input.bool(true, "Ã‰tendre Lignes")

// ==================== COULEURS ====================
C_ZERO = input.color(color.new(#FFEB3B, 30), "Zero Gamma")
C_SUP_MAJ = input.color(color.new(#4CAF50, 40), "Support Majeur")
C_RES_MAJ = input.color(color.new(#F44336, 40), "RÃ©sistance Majeure")
C_SUP = input.color(color.new(#4CAF50, 70), "Support")
C_RES = input.color(color.new(#F44336, 70), "RÃ©sistance")
C_HOT = input.color(color.new(#FF9800, 60), "Hotspot")

// ==================== DONNÃ‰ES ES ====================
var float[] ES_STRIKES = array.from(700.0, 670.0, 700.0, 695.0, 692.5, 694.0, 697.0, 697.5, 694.5, 690.0, 696.0, 698.0, 693.0, 695.5, 705.0, 710.0, 691.5)
var int[] ES_TYPES = array.from(1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
var int[] ES_IMP = array.from(8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7)
var string[] ES_LABELS = array.from("Major Support (OI)", "Major Resistance (OI)", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support")

// ==================== DONNÃ‰ES NQ ====================
var float[] NQ_STRIKES = array.from(631.25, 640.62, 631.25, 642.5, 645.0, 650.0, 640.0, 637.5, 640.5, 652.5, 648.75, 647.5, 641.25, 640.62, 639.5, 638.12, 644.38)
var int[] NQ_TYPES = array.from(1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1)
var int[] NQ_IMP = array.from(8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7)
var string[] NQ_LABELS = array.from("Major Support (OI)", "Major Resistance (OI)", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Support", "Resistance", "Support", "Support", "Support")

// ==================== DÃ‰TECTION ====================
ticker = syminfo.ticker
is_es = str.contains(ticker, "ES")
is_nq = str.contains(ticker, "NQ") or str.contains(ticker, "MNQ")

if not is_es and not is_nq
    runtime.error("âŒ Compatible ES/NQ uniquement")

strikes = is_es ? ES_STRIKES : NQ_STRIKES
types = is_es ? ES_TYPES : NQ_TYPES
imps = is_es ? ES_IMP : NQ_IMP
labels = is_es ? ES_LABELS : NQ_LABELS

// ==================== AFFICHAGE ====================
var line[] lines = array.new_line()
var label[] labs = array.new_label()

if barstate.islast
    for l in lines
        line.delete(l)
    for l in labs
        label.delete(l)
    array.clear(lines)
    array.clear(labs)
    
    for i = 0 to math.min(array.size(strikes) - 1, MAX_LEVELS - 1)
        s = array.get(strikes, i)
        t = array.get(types, i)
        imp = array.get(imps, i)
        lab = array.get(labels, i)
        
        if imp >= MIN_IMP
            c = t == 0 ? C_ZERO : (t == 1 ? (imp >= 9 ? C_SUP_MAJ : C_SUP) : (t == 2 ? (imp >= 9 ? C_RES_MAJ : C_RES) : C_HOT))
            w = imp >= 9 ? 3 : LINE_WIDTH
            st = t == 0 ? line.style_solid : (t == 3 ? line.style_dotted : line.style_dashed)
            ex = EXTEND ? extend.both : extend.none
            
            nl = line.new(bar_index - 50, s, bar_index + 50, s, color=c, width=w, extend=ex, style=st)
            array.push(lines, nl)
            
            if SHOW_LABELS
                pre = t == 0 ? "âš–ï¸ " : (t == 1 ? (imp >= 9 ? "ðŸŸ¢ðŸŸ¢ " : "ðŸŸ¢ ") : (t == 2 ? (imp >= 9 ? "ðŸ”´ðŸ”´ " : "ðŸ”´ ") : "ðŸ”¥ "))
                txt = pre + str.tostring(s, format.mintick)
                if SHOW_GEX
                    txt := txt + "\n" + lab
                sz = imp >= 9 ? size.normal : (imp >= 8 ? size.small : size.tiny)
                nlab = label.new(bar_index, s, txt, color=c, textcolor=color.white, size=sz, style=label.style_label_center)
                array.push(labs, nlab)

// ==================== TABLE ====================
var table tbl = table.new(position.top_right, 2, 4, bgcolor=color.new(#1E1E1E, 5), border_width=2)

if barstate.islast
    table.cell(tbl, 0, 0, "ðŸŽ¯ GEX", text_color=color.white, text_size=size.normal, bgcolor=color.new(#2196F3, 15))
    table.cell(tbl, 1, 0, ticker, text_color=color.yellow, text_size=size.normal, bgcolor=color.new(#2196F3, 15))
    table.cell(tbl, 0, 1, "Prix", text_color=color.gray, text_size=size.small)
    table.cell(tbl, 1, 1, str.tostring(close, format.mintick), text_color=color.white, text_size=size.small)
    table.cell(tbl, 0, 2, "Niveaux", text_color=color.gray, text_size=size.small)
    table.cell(tbl, 1, 2, str.tostring(array.size(lines)), text_color=color.lime, text_size=size.small)
    table.cell(tbl, 0, 3, "MAJ", text_color=color.gray, text_size=size.tiny)
    table.cell(tbl, 1, 3, "2025-12-25", text_color=color.aqua, text_size=size.tiny)

// ==================== ALERTES ====================
for i = 0 to array.size(strikes) - 1
    s = array.get(strikes, i)
    imp = array.get(imps, i)
    if imp >= 9
        if ta.crossover(close, s) or ta.crossunder(close, s)
            alert("Prix croise niveau GEX majeur: " + str.tostring(s), alert.freq_once_per_bar)
